#!/usr/bin/env python 
import os
import sys
import yaml
import argparse
#import ikcms
from ikcms.cli import manage

if __name__ == '__main__':

    parser = argparse.ArgumentParser(description='Ikcms management util')
    parser.add_argument('--cfg', help="Yaml cfg file")
    parser.add_argument('module:action', help="Yaml cfg file")
    parser.add_argument('arg', nargs='*')
    args, _ = parser.parse_known_args()
    filepath = os.path.abspath(args.cfg or 'apps.yaml')
    try:
        with open(filepath) as f:
            apps_cfg = yaml.load(f)
    except OSError:
        print("Can't open file {}".format(filepath))
        sys.exit()

    apps = apps_cfg.get('apps', [])
    paths = apps_cfg.get('paths', [])
    paths.append(os.path.dirname(filepath))

    manage(apps=apps, paths=paths)
